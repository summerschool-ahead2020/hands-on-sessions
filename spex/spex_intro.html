<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>SPEX introduction &#8212; AHEAD2020 school  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Fit a power law in SPEX" href="spex_powerlaw.html" />
    <link rel="prev" title="SPEX hands-on" href="spex.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=blue data-md-color-accent=light-blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#spex/spex_intro" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="AHEAD2020 school  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">AHEAD2020 School</span>
          <span class="md-header-nav__topic"> SPEX introduction </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/summerschool-ahead2020/hands-on-sessions" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hands-on-sessions
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">AHEAD2020 school  documentation</a></li>
          <li class="md-tabs__item"><a href="spex.html" class="md-tabs__link">SPEX hands-on</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="AHEAD2020 school documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="AHEAD2020 school documentation">AHEAD2020 School</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/summerschool-ahead2020/hands-on-sessions" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hands-on-sessions
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#spex-spex-intro--page-root" class="md-nav__link">SPEX introduction</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#the-spex-data-format" class="md-nav__link">The SPEX data format</a>
        </li>
        <li class="md-nav__item"><a href="#starting-spex-in-python-jupyter" class="md-nav__link">Starting SPEX in Python/Jupyter</a>
        </li>
        <li class="md-nav__item"><a href="#plotting-the-data" class="md-nav__link">Plotting the data</a>
        </li>
        <li class="md-nav__item"><a href="#ignoring-and-rebinning" class="md-nav__link">Ignoring and rebinning</a>
        </li>
        <li class="md-nav__item"><a href="#defining-a-model" class="md-nav__link">Defining a model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#distance" class="md-nav__link">Distance</a>
        </li>
        <li class="md-nav__item"><a href="#setting-initial-parameters" class="md-nav__link">Setting initial parameters</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#fitting-the-data" class="md-nav__link">Fitting the data</a>
        </li>
        <li class="md-nav__item"><a href="#calculating-errors" class="md-nav__link">Calculating errors</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/spex/spex_intro.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="spex-introduction">
<h1 id="spex-spex-intro--page-root">SPEX introduction<a class="headerlink" href="#spex-spex-intro--page-root" title="Permalink to this heading">¶</a></h1>
<p>SPEX is a spectral fitting program used to fit high-resolution X-ray
spectra. The code contains several simple and detailed models that are
able to deal with the radiative processes observed in the X-ray band.</p>
<p>SPEX has both a command-line and a Python interface. This chapter
provides some basic commands and threads to fit X-ray
spectra from Python. Alternatively, you could read the
<a class="reference external" href="https://spex-xray.github.io/spex-help/getstarted/runspex.html">Introduction to the SPEX command-line interface</a>.</p>
<p>Before we begin, here are some useful links:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://spex-xray.github.io/spex-help/index.html">SPEX Manual</a></p></li>
<li><p><a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex.html">SPEX Python interface</a></p></li>
<li><p><a class="reference external" href="https://spex-xray.github.io/pyspextools/">Python tools for SPEX data format</a></p></li>
</ul>
<section id="the-spex-data-format">
<h2 id="the-spex-data-format">The SPEX data format<a class="headerlink" href="#the-spex-data-format" title="Permalink to this heading">¶</a></h2>
<p>The data files containing the spectrum of the source and the response
need to be in the correct format. In the SPEX installation, we provide a
program called <a class="reference external" href="https://spex-xray.github.io/spex-help/getstarted/runtrafo.html">trafo</a>
to convert OGIP standard fits files into SPEX format. There is also a Python
based alternative called <a class="reference external" href="https://spex-xray.github.io/pyspextools/tutorials/ogip2spex.html">ogip2spex</a>.
In this chapter, we assume that you already have spectra in SPEX
format provided by the exercises. Each exercise contains a <code class="docutils literal notranslate"><span class="pre">.spo</span></code> and <code class="docutils literal notranslate"><span class="pre">.res</span></code>
file that can be downloaded from this site.</p>
<p>SPEX needs two files per spectrum:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;filename&gt;.spo</span></code> – This file contains the countrate per energy bin
for the source (D<sub>i</sub>), as well as the background countrate and
the errors (σ<sub>i</sub>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;filename&gt;.res</span></code> – This file contains the instrumental response:
the energy redistribution and effective area (R<sub>ij</sub> A<sub>j</sub>).</p></li>
</ul>
<p>In order to calculate the observed model spectrum, SPEX uses this
integral equation to account for the imperfections caused by the
instrument:</p>
<ul class="simple">
<li><p>D(c) =  ∫ R(c,E) A(E) S(E) dE</p></li>
<li><p>D<sub>i</sub>=  Σ<sup>n</sup> <sub>j=1</sub> R<sub>ij</sub>A<sub>j</sub>S<sub>j</sub></p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">.res</span></code> and <code class="docutils literal notranslate"><span class="pre">.spo</span></code> files are so-called FITS files. This is a data
format widely used in Astronomy. FITS files can contain images as well
as data tables. The software package <a class="reference external" href="https://heasarc.gsfc.nasa.gov/ftools/">FTOOLS</a> provided by NASA contains a
large number of tools to manipulate FITS files. If you
are interested, then you can launch <code class="docutils literal notranslate"><span class="pre">flaunch</span></code> to see which tools are
available.</p>
</section>
<section id="starting-spex-in-python-jupyter">
<h2 id="starting-spex-in-python-jupyter">Starting SPEX in Python/Jupyter<a class="headerlink" href="#starting-spex-in-python-jupyter" title="Permalink to this heading">¶</a></h2>
<p>Before you continue, please make sure that you have downloaded the
files from <a class="reference external" href="https://github.com/summerschool-ahead2020/spex-hands-on">https://github.com/summerschool-ahead2020/spex-hands-on</a>
using git as described on the page above.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">intro</span></code> directory that you downloaded using git, contains a
<code class="docutils literal notranslate"><span class="pre">SPEX_Intro.ipynb</span></code> file. You can open this notebook to get a SPEX
demonstration in Python.</p>
<p>When the SPEX package is installed and loaded in the environment successfully,
the notebook should be able to run. Below, we walk through the commands
step-by-step to explain what we do.</p>
<p>In a Python or Jupyter session, SPEX can be started like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspex.spex</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">=</span><span class="n">Session</span><span class="p">()</span>
<span class="go">Welcome user to SPEX version 3.07.03</span>
<span class="go">...</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>The object <cite>s</cite> now contains the SPEX program. Through <cite>s</cite> we can send commands
to SPEX and sometimes get data in return. The commands are very similar to the
commands used on the SPEX command line.</p>
<p>As a first step, we can load the data files. This is done using the <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_data.html#data">s.data()</a> command.
The command first expects the response file (with the <cite>.res</cite> extension) and
then the spectrum file (<cite>.spo</cite> extension). In the intro directory we have a
file called <code class="docutils literal notranslate"><span class="pre">powerl.spo</span></code> and <code class="docutils literal notranslate"><span class="pre">powerl.res</span></code>. To load them, you type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">"powerl.res"</span><span class="p">,</span><span class="s2">"powerl.spo"</span><span class="p">)</span>
</pre></div>
</div>
<p>The responsefile (.res) is entered first and then the file containing
the spectrum (.spo). Remember that the order of the words in the
commands is very important!</p>
</section>
<section id="plotting-the-data">
<h2 id="plotting-the-data">Plotting the data<a class="headerlink" href="#plotting-the-data" title="Permalink to this heading">¶</a></h2>
<p>If the <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_data.html#data">s.data()</a>
command was successful, we can now have a look at the
spectra. Using default settings, the easiest way of plotting a spectrum is
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_data</span><span class="p">()</span>
</pre></div>
</div>
<p>The command above opens a Matplotlib window and tells SPEX that we
want to plot the spectral data (<a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_plot.html#plot-data">s.plot_data()</a>).
This will create a linear-linear plot in keV units.</p>
<p>The plot can be tailored to your wishes. Below is an example to create a
plot to a log-log plot in Å:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">xlog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To make sure the axes are logarithmic, we provide the options (<code class="docutils literal notranslate"><span class="pre">xlog=True</span></code> and
<code class="docutils literal notranslate"><span class="pre">ylog=True</span></code>) and change the axes to unit Å using <code class="docutils literal notranslate"><span class="pre">wave=true</span></code>.</p>
<p>If you want to change more features of the plot, you can get the
matplotlib <code class="docutils literal notranslate"><span class="pre">plt</span></code> object from the command like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">pdata</span><span class="p">,</span> <span class="n">plt</span><span class="p">)</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pdata</span></code> object contains an astropy table with the plot data, while the
<code class="docutils literal notranslate"><span class="pre">plt</span></code> object contains the matplotlib.pyplot object. You can use this plt object to
change plot features, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
</pre></div>
</div>
<p>To change the reach of the x and y axes. You can use all the available
matplotlib.pyplot commands to modify your plot and finally show it with
the <code class="docutils literal notranslate"><span class="pre">plt.show()</span></code> command.</p>
</section>
<section id="ignoring-and-rebinning">
<h2 id="ignoring-and-rebinning">Ignoring and rebinning<a class="headerlink" href="#ignoring-and-rebinning" title="Permalink to this heading">¶</a></h2>
<p>High-resolution X-ray spectra from Chandra and XMM-Newton are usually
oversampled (e.g. the energy bins are much smaller than the spectral
resolution) and contain a lot more channels then is useful. Therefore,
it is necessary to remove wavelength intervals which contain bad data
and rebin your spectrum. The SPEX command to ignore parts of the spectrum
is called <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_data.html#data-selection">s.ignore()</a>
and the command to rebin is called <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_data.html#binning-and-data-selection">s.bin()</a>.
In the next example we bin the spectrum over the 0.5 to 10 keV range with
a factor of 5 and ignore the rest of the spectrum:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'kev'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'kev'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'kev'</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_data.html#data-selection">s.ignore()</a>
and <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_data.html#binning-and-data-selection">s.bin()</a>
commands need to know which spectrum in the
data structure you want to change. If you just loaded one spectrum, this is
easy. SPEX organizes spectra in instruments and regions. The first spectrum
is by default in instrument 1 and region 1. The first two places in the
<a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_data.html#data-selection">s.ignore()</a>
and <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_data.html#binning-and-data-selection">s.bin()</a>
commands need to contain the instrument number and
the region number of the spectrum that you want to change.</p>
<p>The third and forth number is the energy range to apply the command to. So,
the third number is the minimum energy and the forth the maximum.</p>
<p>For the bin command, the binning factor is the fifth entry. Finally, we
provide the unit of our energy values as <code class="docutils literal notranslate"><span class="pre">unit='kev'</span></code> in the last entry
of the command.</p>
</section>
<section id="defining-a-model">
<h2 id="defining-a-model">Defining a model<a class="headerlink" href="#defining-a-model" title="Permalink to this heading">¶</a></h2>
<p>Now we have a clean and rebinned spectrum that is ready to fit. Before
we can start fitting, we first need to define a model. It’s equivalent
to S(E) in the equation above. The model can contain
one or more of these components:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">absm</span></code> Model for interstellar absorption.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reds</span></code> Redshift.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">po</span></code> Powerlaw.</p></li>
</ul>
<p>And <a class="reference external" href="https://spex-xray.github.io/spex-help/models.html">there are more</a>!
The following command sequence defines a simple powerlaw model at a certain
redshift and absorbed by the interstellar medium. The individual components
of the model are loaded one-by-one with the <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#components">s.com()</a> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">com</span><span class="p">(</span><span class="s1">'reds'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">com</span><span class="p">(</span><span class="s1">'absm'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">com</span><span class="p">(</span><span class="s1">'po'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">com_rel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
<p>The last command (<a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#component-relate">s.com_rel(1,3,numpy.array([1,2]))</a>)
tells SPEX that component 3, the powerlaw, is first redshifted by component 1
and then absorbed by component 2. The order of the 1 and the 2 is
important! Always think what happens in which order on the way from
the source to the telescope.</p>
<section id="distance">
<h3 id="distance">Distance<a class="headerlink" href="#distance" title="Permalink to this heading">¶</a></h3>
<p>For most sources the distance is more or less known. To get a right
luminosity estimate for the source, the expected distance has to be
provided to SPEX. This is done with the <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#distance">s.distance()</a>
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'z'</span><span class="p">)</span>
</pre></div>
</div>
<p>With this command, the distance to the source is set to a redshift of
0.1.</p>
</section>
<section id="setting-initial-parameters">
<h3 id="setting-initial-parameters">Setting initial parameters<a class="headerlink" href="#setting-initial-parameters" title="Permalink to this heading">¶</a></h3>
<p>Now we have to estimate the initial parameters. With the command
<a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#show-parameters">s.par_show()</a>
we can see which parameters there are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">par_show</span><span class="p">()</span>
<span class="go">----------------------------------------------------------------------------------</span>
<span class="go">sect comp mod  acro parameter with unit     value      status    minimum   maximum</span>

<span class="go">  1    1 reds z    Redshift              0.000000     frozen   -1.0      1.00E+10</span>

<span class="go">  1    2 absm nh   Column (1E28/m**2)   9.9999997E-05 thawn     0.0      1.00E+20</span>
<span class="go">  1    2 absm f    Covering fraction     1.000000     frozen    0.0       1.0</span>

<span class="go">  1    3 pow  norm Norm (1E44 ph/s/keV)  1.000000     thawn     0.0      1.00E+20</span>
<span class="go">  1    3 pow  gamm Photon index          2.000000     thawn    -10.       10.</span>
<span class="go">  1    3 pow  dgam Photon index break    0.000000     frozen   -10.       10.</span>
<span class="go">  1    3 pow  e0   Break energy (keV)   1.0000000E+10 frozen    0.0      1.00E+20</span>
<span class="go">  1    3 pow  b    Break strength        0.000000     frozen    0.0       10.</span>
<span class="go">  1    3 pow  type Type of norm          0.000000     frozen    0.0       1.0</span>
<span class="go">  1    3 pow  elow Low flux limit (keV)  2.000000     frozen   1.00E-20  1.00E+10</span>
<span class="go">  1    3 pow  eupp Upp flux limit (keV)  10.00000     frozen   1.00E-20  1.00E+10</span>
<span class="go">  1    3 pow  lum  Luminosity (1E30 W)   1.000000     frozen    0.0      1.00E+20</span>

<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">Fluxes and restframe luminosities between   2.0000     and    10.000     keV</span>

<span class="go">sect comp mod   photon flux   energy flux nr of photons    luminosity</span>
<span class="go">           (phot/m**2/s)      (W/m**2)   (photons/s)           (W)</span>
<span class="go">   1    3 pow    0.00000       0.00000       0.00000       0.00000</span>
</pre></div>
</div>
<p>We can set the parameters using the <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#setting-parameters">s.par()</a>
command. The commands then look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">par</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'z'</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">par</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'nh'</span><span class="p">,</span> <span class="mf">2.E-3</span><span class="p">,</span> <span class="n">thawn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">par</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'norm'</span><span class="p">,</span> <span class="mf">1.E+10</span><span class="p">,</span> <span class="n">thawn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">par</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'gamm'</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">thawn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>When the parameter should be free during the fit, then add the optional <code class="docutils literal notranslate"><span class="pre">thawn=True</span></code> parameter
to the command. Then, we run <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#show-parameters">s.par_show()</a>
again to see what happened:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">par_show</span><span class="p">()</span>
<span class="go">----------------------------------------------------------------------------------</span>
<span class="go">sect comp mod  acro parameter with unit     value      status    minimum   maximum</span>

<span class="go">   1    1 reds z    Redshift              0.100000     frozen   -1.0      1.00E+10</span>

<span class="go">   1    2 absm nh   Column (1E28/m**2)   2.0000001E-03 thawn     0.0      1.00E+20</span>
<span class="go">   1    2 absm f    Covering fraction     1.000000     frozen    0.0       1.0</span>

<span class="go">   1    3 pow  norm Norm (1E44 ph/s/keV)  1.000000E+10 thawn     0.0      1.00E+20</span>
<span class="go">   1    3 pow  gamm Photon index          1.500000     thawn    -10.       10.</span>
<span class="go">   1    3 pow  dgam Photon index break    0.000000     frozen   -10.       10.</span>
<span class="go">   1    3 pow  e0   Break energy (keV)   1.0000000E+10 frozen    0.0      1.00E+20</span>
<span class="go">   1    3 pow  b    Break strength        0.000000     frozen    0.0       10.</span>
<span class="go">   1    3 pow  type Type of norm          0.000000     frozen    0.0       1.0</span>
<span class="go">   1    3 pow  elow Low flux limit (keV)  2.000000     frozen   1.00E-20  1.00E+10</span>
<span class="go">   1    3 pow  eupp Upp flux limit (keV)  10.00000     frozen   1.00E-20  1.00E+10</span>
<span class="go">   1    3 pow  lum  Luminosity (1E30 W)  5.6014867E+08 frozen    0.0      1.00E+20</span>

<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">Fluxes and restframe luminosities between   2.0000     and    10.000     keV</span>

<span class="go"> sect comp mod   photon flux   energy flux nr of photons    luminosity</span>
<span class="go">            (phot/m**2/s)      (W/m**2)   (photons/s)           (W)</span>
<span class="go">    1    3 pow    0.00000       0.00000       0.00000       0.00000</span>
</pre></div>
</div>
<p>Finding the right initial values for the parameters is a game of trial
and error. To see whether you are going in the right direction, you can
calculate the model with the command <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#calculate">s.calc()</a> and
see the result with <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_plot.html#plot-data">s.plot_data()</a>.
If you see the model appear in your screen, then the model
is close enough to be fitted. Especially the normalization of the powerlaw
(<code class="docutils literal notranslate"><span class="pre">norm</span></code>) can vary a lot depending on the count rate of the source.</p>
</section>
</section>
<section id="fitting-the-data">
<h2 id="fitting-the-data">Fitting the data<a class="headerlink" href="#fitting-the-data" title="Permalink to this heading">¶</a></h2>
<p>We are ready to fit the data! You can give the <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_opt.html#fit">s.fit()</a> command to
start fitting. When the fit is done, then the parameters and C-stat are
printed on screen. If the C-stat value is
close to the expected C-stat value, then your fit is acceptable.
Sometimes more runs of the command <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_opt.html#fit">s.fit()</a> are
necessary after changing some initial parameters. This is especially true
when using complex models. Again this is a game of trial and error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>You also might want to fix or free certain parameters to see if they can
be constrained. You can fix a parameter with the command <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#fix-free-parameters">s.par_fix</a> and
freeing is done with <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_model.html#fix-free-parameters">s.par_free()</a>
(thawn). For example, you can free the N<sub>H</sub> by the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">par_free</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">'nh'</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="calculating-errors">
<h2 id="calculating-errors">Calculating errors<a class="headerlink" href="#calculating-errors" title="Permalink to this heading">¶</a></h2>
<p>When the fit is acceptable, you might want to know the uncertainties on
your fitted parameters. Errors are determined one-by-one by fixing the
parameter to some value and calculate the ΔC-stat with
respect to the best fit. If you want to know the 1σ error
on the parameter, you need to know its values at ΔC-stat = 1.
This is done by the <a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/com_opt.html#error">s.error</a> command. You
can calculate the error for each parameter. For example gamma:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gamm_err</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">'gamm'</span><span class="p">)</span>
</pre></div>
</div>
<p>The result of the error calculation is stored in the
<a class="reference external" href="https://spex-xray.github.io/spex-help/pyspex/optimize.html#error-calculation">gamm_err</a> object.</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="spex.html" title="SPEX hands-on"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> SPEX hands-on </span>
              </div>
            </a>
          
          
            <a href="spex_powerlaw.html" title="Fit a power law in SPEX"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Fit a power law in SPEX </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2023, AHEAD2020 High-resolution spectroscopy school.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>